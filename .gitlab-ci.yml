variables:
  IMAGE_NAME_DEVELOPMENT: $CI_REGISTRY/ketty/editoria/editoria-dev
  # IMAGE_ORG: cokoapps
  # IMAGE_NAME: ketida-server-develop
  # WORKDIR: /home/node/ketida

stages:
  - build development
  - lint
  - build preproduction
  - publish
  - deploy

build:
  image: docker:26
  stage: build development
  services:
    - docker:26-dind
  before_script:
    - echo "$CI_REGISTRY_PASSWORD" | docker login "$CI_REGISTRY" -u "$CI_REGISTRY_USER" --password-stdin
  script:
    - docker build --tag $IMAGE_NAME_DEVELOPMENT:$CI_COMMIT_SHA -f Dockerfile-development .
    - docker push $IMAGE_NAME_DEVELOPMENT:$CI_COMMIT_SHA

.lint js:
  stage: lint
  image: $IMAGE_ORG/$IMAGE_NAME:$CI_COMMIT_SHA
  script:
    - cd $WORKDIR
    - yarn eslint .
